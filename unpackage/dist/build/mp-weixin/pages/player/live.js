(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/player/live"],{1021:function(t,e,n){"use strict";var i;n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return i}));var o=function(){var t=this,e=t.$createElement;t._self._c},s=[]},"28e8":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=s(n("a34a")),o=n("1a6e");function s(t){return t&&t.__esModule?t:{default:t}}function a(t,e,n,i,o,s,a){try{var r=t[s](a),c=r.value}catch(l){return void n(l)}r.done?e(c):Promise.resolve(c).then(i,o)}function r(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var s=t.apply(e,n);function r(t){a(s,i,o,r,c,"next",t)}function c(t){a(s,i,o,r,c,"throw",t)}r(void 0)}))}}var c=new o.FifoCache(1e4),l=new o.syncFifoCache(1e4),h={data:function(){return{ctx:"",points:[],show:!1,canvasStyle:"width:400 px; height: 700px;",boardInfo:Object,webInfo:Object,xRatio:0,yRatio:0,liveFlag:!1,syncFlag:!1,number:0,timer:0,w:0,h:0}},onLoad:function(e){var n=this;return r(i.default.mark((function o(){var s;return i.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return console.log(e),i.next=3,n.$refresh(e);case 3:n.boardInfo=getApp().globalData.boardInfo,console.log(n.boardInfo),n.webInfo=getApp().globalData.webInfo,n.ctx=t.createCanvasContext("SmartScreen",n),n.setPenStyle(),n.setCanvas(),n.timer=new Date((new Date).setHours(0,0,0,0))/1e3,n.timer=1e3*n.timer,t.onWindowResize((function(e){t.showLoading({title:"组件加载中"});var i={height:e.size.windowHeight,width:e.size.windowWidth};n.updateResize(i)})),s="ws://"+getApp().globalData.ws+"/"+getApp().globalData.sid+"/tmp",console.log(s),t.connectSocket({url:s}),n.sync(),n.run();case 17:case"end":return i.stop()}}),o)})))()},onReady:function(){var e=this;t.onSocketMessage((function(t){var n=Array.prototype.map.call(new Uint8Array(t.data),(function(t){return("00"+t.toString(16)).slice(-2)})).join(""),i=0,o=0,s=0,a=0;e.webInfo.pixelRatio;if(n.length>10){var r=n.substr(2,4),c=n.substr(6,4),l=n.substr(10,n.length);o=e.hexStrToDEC(r),s=e.hexStrToDEC(c),a=e.hexStrToDEC(l);var h=e.h/4030*o,f=e.w/3921*s;o=f,o=e.w-o,s=h;var u=n.substr(0,2);i=e.hexStrToDEC(u),e.setFifo(i,o,s,a,1)}else{var d=n.substr(2,n.length);a=e.hexStrToDEC(d);var p=n.substr(0,2);i=e.hexStrToDEC(p),e.setFifo(i,null,null,a,0)}}))},methods:{setPenStyle:function(){this.ctx.lineWidth=1,this.ctx.setStrokeStyle(this.nowPenColor),this.ctx.lineCap="round",this.ctx.lineJoin="round"},setCanvas:function(){var t={height:this.webInfo.windowHeight,width:this.webInfo.windowWidth};this.updateResize(t)},updateResize:function(t){console.log(t);var e=t.width,n=t.height,i=this.webInfo.pixelRatio,o=this.boardInfo.physWidth/this.boardInfo.physHeight,s=0,a=0;e/n>o?(s=n,a=n*o):(a=e,s=e*o),this.w=a,this.h=s,this.xRatio=this.boardInfo.maximumX/a,this.yRatio=this.boardInfo.maximumY/s,console.log("maximumX:"+this.boardInfo.maximumX+" canvasWidth:"+a+" pixelRatio:"+i+" xRatio:"+this.xRatio+" yRatio:"+this.yRatio),this.canvasStyle="width: "+a+"px; height: "+s+"px;",console.log("canvasWidth:"+a+"  canvasHeight:"+s),this.show=!0},hexStrToDEC:function(t){for(var e,n=t.length,i=new Array(n),o=0;o<n;o++)e=t.charCodeAt(o),48<=e&&e<58?e-=48:e=(223&e)-65+10,i[o]=e;return i.reduce((function(t,e){return t=16*t+e,t}),0)},setFifo:function(t,e,n,i,o){console.log("setFifo eventType:"+t+"x:"+e+"y:"+n),64&t&&(console.log("over"),t&=63,this.syncFlag=!0,this.ctx.beginPath()),this.typeJudge(t)?(t&=15,this.installLiveFifo(t,e,n,i,o)):(t&=15,this.installSyncFifo(t,e,n,i,o))},installSyncFifo:function(t,e,n,i,o){o?l.set({type:t,X:e,Y:n,timeStamp:i}):l.set({type:t,timeStamp:i})},installLiveFifo:function(t,e,n,i,o){o?c.set({type:t,X:e,Y:n,timeStamp:i}):c.set({type:t,timeStamp:i})},typeJudge:function(t){return t>>5==1?0:1},dataHandler:function(t){if(console.log(t),0==t.type)this.ctx.beginPath();else if(1==t.type)this.points=[];else if(5==t.type)this.setNowPenColor("#ff0000");else if(3==t.type)this.setNowPenColor("#000000");else if(4==t.type)this.setNowPenColor("#00aaff");else if(6==t.type)this.finish();else if(7==t.type)this.clearAll();else if(2==t.type);else if(10==t.type)this.ctx.setFillStyle("#ffffff"),this.ctx.setStrokeStyle("#ffffff"),this.ctx.arc(t.X,t.Y,20,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),this.ctx.draw(!0);else{this.setNowPenColor(this.nowPenColor),this.points.push(t);var e=this.points.length;e>=2&&this.draw()}},clearAll:function(){var e=this;t.getSystemInfo({success:function(t){var n=t.windowWidth,i=t.windowHeight;e.ctx.clearRect(0,0,n,i),e.ctx.draw(!0)}})},draw:function(){var t=this.points[0],e=this.points[1];this.points.shift(),this.ctx.moveTo(t.X,t.Y),this.ctx.lineTo(e.X,e.Y),this.ctx.stroke(),this.ctx.draw(!0)},setNowPenColor:function(t){this.ctx.setFillStyle(t),this.ctx.setStrokeStyle(t),this.nowPenColor=t},getMultiple:function(){var t=this.webInfo.screenWidth,e=this.webInfo.screenHeight;return t>e?e/this.physHeight:t/this.physWidth},run:function(){var t=this;setInterval((function(){if(t.liveFlag&&c.len()){var e=c.get(),n=(new Date).getTime()-t.timer;n>=e.timeStamp+1&&(e=c.reget(),t.dataHandler(e))}}),10)},sync:function(){var e=this;setInterval((function(){while(e.syncFlag&&l.get())e.dataHandler(l.reget()),l.get()||(t.hideLoading(),e.liveFlag=!0)}),0)}}};e.default=h}).call(this,n("543d")["default"])},"46cf":function(t,e,n){"use strict";var i=n("cbef"),o=n.n(i);o.a},"549d":function(t,e,n){"use strict";n.r(e);var i=n("28e8"),o=n.n(i);for(var s in i)"default"!==s&&function(t){n.d(e,t,(function(){return i[t]}))}(s);e["default"]=o.a},cbef:function(t,e,n){},dc9b:function(t,e,n){"use strict";n.r(e);var i=n("1021"),o=n("549d");for(var s in o)"default"!==s&&function(t){n.d(e,t,(function(){return o[t]}))}(s);n("46cf");var a,r=n("f0c5"),c=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],a);e["default"]=c.exports},e858:function(t,e,n){"use strict";(function(t){n("e983");i(n("66fd"));var e=i(n("dc9b"));function i(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n("543d")["createPage"])}},[["e858","common/runtime","common/vendor"]]]);