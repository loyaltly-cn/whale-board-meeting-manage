(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/player/playBack"],{"10a9":function(t,e,i){"use strict";(function(t){i("e983");n(i("66fd"));var e=n(i("f43d"));function n(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=i,t(e.default)}).call(this,i("543d")["createPage"])},afbf:function(t,e,i){"use strict";i.r(e);var n=i("ce2e"),o=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,(function(){return n[t]}))}(a);e["default"]=o.a},ce2e:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(i("a34a")),o=i("1a6e"),a=i("0e99");function s(t){return t&&t.__esModule?t:{default:t}}function r(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(f){return void i(f)}r.done?e(l):Promise.resolve(l).then(n,o)}function l(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){r(a,n,o,s,l,"next",t)}function l(t){r(a,n,o,s,l,"throw",t)}s(void 0)}))}}var f=new o.FifoCache(1e4),c=new o.syncFifoCache(1e4),h=new a.cacheFifo,u={data:function(){return{ctx:"",points:[],show:!1,canvasStyle:"width:400 px; height: 700px;",boardInfo:Object,webInfo:Object,xRatio:0,yRatio:0,liveFlag:!1,syncFlag:!1,number:0,start:0,timeFlag:!0}},onLoad:function(e){var i=this;return l(n.default.mark((function o(){var a;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.showLoading({title:"组件加载中"}),n.next=3,i.$refresh(e);case 3:i.boardInfo=getApp().globalData.boardInfo,i.webInfo=getApp().globalData.webInfo,i.ctx=t.createCanvasContext("SmartScreen",i),i.setPenStyle(),i.setCanvas(),a="ws://"+getApp().globalData.ws+"/"+getApp().globalData.sid+"/tmp",console.log(a),t.connectSocket({url:a}),i.sync(),i.run();case 13:case"end":return n.stop()}}),o)})))()},onReady:function(){var e=this;t.onSocketMessage((function(t){var i=Array.prototype.map.call(new Uint8Array(t.data),(function(t){return("00"+t.toString(16)).slice(-2)})).join("");console.log("接收数量:"+e.number+++"\t数据:"+i);var n=0,o=0,a=0,s=0;e.webInfo.pixelRatio;if(i.length>10){var r=i.substr(2,4),l=i.substr(6,4),f=i.substr(10,i.length);o=e.hexStrToDEC(l),a=e.hexStrToDEC(r),s=e.hexStrToDEC(f),o/=e.xRatio,a/=e.yRatio;var c=i.substr(0,2);n=e.hexStrToDEC(c),e.setFifo(n,o,a,s,1)}else{var h=i.substr(2,i.length);s=e.hexStrToDEC(h);var u=i.substr(0,2);n=e.hexStrToDEC(u),e.setFifo(n,null,null,s,0)}}))},methods:{setPenStyle:function(){console.log(this.canvasStyle)},setCanvas:function(){var t={height:this.webInfo.windowHeight,width:this.webInfo.windowWidth};this.updateResize(t)},updateResize:function(t){var e=t.width,i=t.height,n=this.webInfo.pixelRatio,o=this.boardInfo.physWidth/this.boardInfo.physHeight,a=0,s=0;e/i>o?(a=i/n,s=i*o/n):(s=e/n,a=e/o/n),this.xRatio=this.boardInfo.maximumX/s/n,this.yRatio=this.boardInfo.maximumY/a/n,console.log("maximumX:"+this.boardInfo.maximumX+" canvasWidth:"+s+" pixelRatio:"+n+" xRatio:"+this.xRatio+" yRatio:"+this.yRatio),this.canvasStyle="width: "+s+"px; height: "+a+"px;",this.show=!0},hexStrToDEC:function(t){for(var e,i=t.length,n=new Array(i),o=0;o<i;o++)e=t.charCodeAt(o),48<=e&&e<58?e-=48:e=(223&e)-65+10,n[o]=e;return n.reduce((function(t,e){return t=16*t+e,t}),0)},setFifo:function(t,e,i,n,o){if(64&t){var a=n;console.log("over: "+a),console.log("时间: "+(a-this.start)),t&=63,t&=15,this.installCacheFifo(t,e,i,n,o),this.fifoHandler(20)}t&=15,this.installCacheFifo(t,e,i,n,o)},installCacheFifo:function(t,e,i,n,o){o?h.set({type:t,X:e,Y:i,timeStamp:n}):h.set({type:t,timeStamp:n})},installSyncFifo:function(t,e,i,n,o){o?c.set({type:t,X:e,Y:i,timeStamp:n}):c.set({type:t,timeStamp:n})},installLiveFifo:function(t,e,i,n,o){o?f.set({type:t,X:e,Y:i,timeStamp:n}):f.set({type:t,timeStamp:n})},typeJudge:function(t){return t>>5==1?0:1},dataHandler:function(t){if(0==t.type)this.ctx.beginPath();else if(1==t.type)this.points=[];else if(5==t.type)this.setNowPenColor("#ff0000");else if(3==t.type)this.setNowPenColor("#000000");else if(4==t.type)this.setNowPenColor("#00aaff");else if(6==t.type)this.finish();else if(7==t.type)this.clearAll();else if(2==t.type);else if(10==t.type)this.ctx.setFillStyle("#ffffff"),this.ctx.setStrokeStyle("#ffffff"),this.ctx.arc(t.X,t.Y,20,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),this.ctx.draw(!0);else{this.setNowPenColor(this.nowPenColor),this.points.push(t);var e=this.points.length;e>=2&&this.draw()}},clearAll:function(){var e=this;t.getSystemInfo({success:function(t){var i=t.windowWidth,n=t.windowHeight;e.ctx.clearRect(0,0,i,n),e.ctx.draw(!0)}})},draw:function(){var t=this.points[0],e=this.points[1];this.points.shift(),this.ctx.moveTo(t.X,t.Y),this.ctx.lineTo(e.X,e.Y),this.ctx.stroke(),this.ctx.draw(!0)},setNowPenColor:function(t){this.ctx.setFillStyle(t),this.ctx.setStrokeStyle(t),this.nowPenColor=t},getMultiple:function(){var t=this.webInfo.screenWidth,e=this.webInfo.screenHeight;return t>e?e/this.physHeight:t/this.physWidth},fifoHandler:function(t){c.clear(),f.clear();var e=h.getSync(t),i=h.getFifo(t),n=h.getIndex(t);console.log(n),this.timer=n.timeStamp,0!=e.length&&(this.syncFlag=!0,this.fifoEach(e,0)),this.liveflag=!0,this.fifoEach(i,1)},fifoEach:function(t,e){if(e){var i=this;t.forEach((function(t){var e=t.type,n=t.timeStamp;if(t.X){var o=t.X,a=t.Y;i.installLiveFifo(e,o,a,n,1)}else i.installLiveFifo(e,null,null,n,0)}))}else{var n=this;t.forEach((function(t){var e=t.type,i=t.timeStamp;if(t.X){var o=t.X,a=t.Y;n.installSyncFifo(e,o,a,i,1)}else n.installSyncFifo(e,null,null,i,0)}))}},run:function(){var t=this;setInterval((function(){if(t.liveFlag&&f.len()){var e=f.get();(new Date).getTime(),t.timer;t.timer++==e.timeStamp&&(e=f.reget(),t.dataHandler(e))}}),0)},sync:function(){var e=this;setInterval((function(){while(e.syncFlag&&c.get())e.dataHandler(c.reget()),c.get()||(t.hideLoading(),e.liveFlag=!0)}),0)}}};e.default=u}).call(this,i("543d")["default"])},e260:function(t,e,i){"use strict";var n;i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return n}));var o=function(){var t=this,e=t.$createElement;t._self._c},a=[]},f43d:function(t,e,i){"use strict";i.r(e);var n=i("e260"),o=i("afbf");for(var a in o)"default"!==a&&function(t){i.d(e,t,(function(){return o[t]}))}(a);var s,r=i("f0c5"),l=Object(r["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);e["default"]=l.exports}},[["10a9","common/runtime","common/vendor"]]]);